<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:activiti="http://activiti.org/bpmn" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" xmlns:xsd="http://www.w3.org/2001/XMLSchema" id="sample-diagram" targetNamespace="http://bpmn.io/schema/bpmn" xsi:schemaLocation="http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd">
  <process id="process-9ef8a3fa-8169-4bb0-aa1f-f54feafaf5da" name="abtestsample" isExecutable="true">
    <startEvent id="StartEvent_1">
      <outgoing>SequenceFlow_174ki97</outgoing>
    </startEvent>
    <sequenceFlow id="SequenceFlow_174ki97" sourceRef="StartEvent_1" targetRef="ParallelGateway_16h86fn" />
    <serviceTask id="ServiceTask_0qlvkxh" name="a/b test&#10;отправить смс или позвонить&#10;" implementation="dice.roll">
      <incoming>SequenceFlow_0mo05b9</incoming>
    </serviceTask>
    <exclusiveGateway id="ExclusiveGateway_0vsokls">
      <incoming>SequenceFlow_1truxe8</incoming>
      <outgoing>SequenceFlow_0ftj44v</outgoing>
      <outgoing>SequenceFlow_03b48nn</outgoing>
    </exclusiveGateway>
    <sequenceFlow id="SequenceFlow_1truxe8" sourceRef="ServiceTask_0qlvkxh" targetRef="ExclusiveGateway_0vsokls" />
    <sequenceFlow id="SequenceFlow_0ftj44v" name="90 % смс" sourceRef="ExclusiveGateway_0vsokls" targetRef="ServiceTask_09e57d3">
      <conditionExpression xsi:type="tFormalExpression">${abtest_var_output &lt;= 90}</conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="SequenceFlow_0p7snl7" sourceRef="ScriptTask_1bwvilh" targetRef="EndEvent_0g5eu8j" />
    <scriptTask id="ScriptTask_1bwvilh" name="set result" scriptFormat="JavaScript" activiti:autoStoreVariables="false">
      <incoming>SequenceFlow_0ta5p5z</incoming>
      <script>var scriptVar = smsSendResult >= 80 ? "success" : "fail";
        execution.setVariable("result", scriptVar);</script>
    </scriptTask>
    <sequenceFlow id="SequenceFlow_03b48nn" sourceRef="ExclusiveGateway_0vsokls" targetRef="UserTask_116oc31">
      <conditionExpression xsi:type="tFormalExpression">${abtest_var_output &gt; 90}</conditionExpression>
    </sequenceFlow>
    <userTask id="UserTask_116oc31" name="позвонить клиенту" activiti:assignee="testuser">
      <incoming>SequenceFlow_03b48nn</incoming>
      <outgoing>SequenceFlow_073eyue</outgoing>
    </userTask>
    <serviceTask id="ServiceTask_09e57d3" name="отправить смс" implementation="dice.roll">
      <incoming>SequenceFlow_0ftj44v</incoming>
      <outgoing>SequenceFlow_0ta5p5z</outgoing>
    </serviceTask>
    <sequenceFlow id="SequenceFlow_0ta5p5z" sourceRef="ServiceTask_09e57d3" targetRef="ScriptTask_1bwvilh" />
    <sequenceFlow id="SequenceFlow_0mo05b9" sourceRef="ParallelGateway_16h86fn" targetRef="ServiceTask_0qlvkxh" />
    <parallelGateway id="ParallelGateway_16h86fn">
      <incoming>SequenceFlow_174ki97</incoming>
      <outgoing>SequenceFlow_0mo05b9</outgoing>
      <outgoing>SequenceFlow_1w2llya</outgoing>
    </parallelGateway>
    <sequenceFlow id="SequenceFlow_1w2llya" sourceRef="ParallelGateway_16h86fn" targetRef="IntermediateCatchEvent_0q6ven5" />
    <intermediateCatchEvent id="IntermediateCatchEvent_0q6ven5">
      <incoming>SequenceFlow_1w2llya</incoming>
      <outgoing>SequenceFlow_09h2031</outgoing>
      <timerEventDefinition>
        <timeDuration xsi:type="tFormalExpression">PT2M</timeDuration>
      </timerEventDefinition>
    </intermediateCatchEvent>
    <sequenceFlow id="SequenceFlow_09h2031" sourceRef="IntermediateCatchEvent_0q6ven5" targetRef="ScriptTask_0iir1h0" />
    <scriptTask id="ScriptTask_0iir1h0" name="set fail" scriptFormat="JavaScript">
      <incoming>SequenceFlow_09h2031</incoming>
      <outgoing>SequenceFlow_0p4haxv</outgoing>
      <script>var scriptVar = "fail";
        execution.setVariable("result", scriptVar);</script>
    </scriptTask>
    <sequenceFlow id="SequenceFlow_0p4haxv" sourceRef="ScriptTask_0iir1h0" targetRef="EndEvent_0ezv08z" />
    <endEvent id="EndEvent_0ezv08z">
      <incoming>SequenceFlow_0p4haxv</incoming>
      <terminateEventDefinition id="TerminateEventDefinition_0v4dyzz" />
    </endEvent>
    <endEvent id="EndEvent_0g5eu8j">
      <incoming>SequenceFlow_0p7snl7</incoming>
      <incoming>SequenceFlow_07tn4l8</incoming>
      <terminateEventDefinition id="TerminateEventDefinition_2" />
    </endEvent>
    <scriptTask id="ScriptTask_0sq8f8r" name="set success" scriptFormat="JavaScript">
      <incoming>SequenceFlow_073eyue</incoming>
      <outgoing>SequenceFlow_07tn4l8</outgoing>
      <script>var scriptVar = "success";
        execution.setVariable("result", scriptVar);</script>
    </scriptTask>
    <sequenceFlow id="SequenceFlow_073eyue" sourceRef="UserTask_116oc31" targetRef="ScriptTask_0sq8f8r" />
    <sequenceFlow id="SequenceFlow_07tn4l8" sourceRef="ScriptTask_0sq8f8r" targetRef="EndEvent_0g5eu8j" />
  </process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_process-9ef8a3fa-8169-4bb0-aa1f-f54feafaf5da">
    <bpmndi:BPMNPlane id="BPMNPlane_process-9ef8a3fa-8169-4bb0-aa1f-f54feafaf5da" bpmnElement="process-9ef8a3fa-8169-4bb0-aa1f-f54feafaf5da">
      <bpmndi:BPMNShape id="BPMNShape_StartEvent_1" bpmnElement="StartEvent_1">
        <omgdc:Bounds x="285" y="240" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_ServiceTask_0qlvkxh" bpmnElement="ServiceTask_0qlvkxh">
        <omgdc:Bounds x="505" y="218" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_ExclusiveGateway_0vsokls" bpmnElement="ExclusiveGateway_0vsokls" isMarkerVisible="true">
        <omgdc:Bounds x="665" y="233" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_ScriptTask_1bwvilh" bpmnElement="ScriptTask_1bwvilh">
        <omgdc:Bounds x="923" y="79" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="BPMNEdge_SequenceFlow_174ki97" bpmnElement="SequenceFlow_174ki97">
        <omgdi:waypoint x="321" y="258" />
        <omgdi:waypoint x="358" y="258" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_SequenceFlow_1truxe8" bpmnElement="SequenceFlow_1truxe8">
        <omgdi:waypoint x="605" y="258" />
        <omgdi:waypoint x="665" y="258" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_SequenceFlow_0ftj44v" bpmnElement="SequenceFlow_0ftj44v">
        <omgdi:waypoint x="690" y="233" />
        <omgdi:waypoint x="690" y="119" />
        <omgdi:waypoint x="751" y="119" />
        <bpmndi:BPMNLabel>
          <omgdc:Bounds x="639" y="153" width="47" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_SequenceFlow_0p7snl7" bpmnElement="SequenceFlow_0p7snl7">
        <omgdi:waypoint x="1023" y="119" />
        <omgdi:waypoint x="1057" y="119" />
        <omgdi:waypoint x="1057" y="250" />
        <omgdi:waypoint x="1108" y="250" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_SequenceFlow_03b48nn" bpmnElement="SequenceFlow_03b48nn">
        <omgdi:waypoint x="690" y="283" />
        <omgdi:waypoint x="690" y="303" />
        <omgdi:waypoint x="751" y="303" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="UserTask_116oc31_di" bpmnElement="UserTask_116oc31">
        <omgdc:Bounds x="751" y="263" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ServiceTask_09e57d3_di" bpmnElement="ServiceTask_09e57d3">
        <omgdc:Bounds x="751" y="79" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_0ta5p5z_di" bpmnElement="SequenceFlow_0ta5p5z">
        <omgdi:waypoint x="851" y="119" />
        <omgdi:waypoint x="923" y="119" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_0mo05b9_di" bpmnElement="SequenceFlow_0mo05b9">
        <omgdi:waypoint x="408" y="258" />
        <omgdi:waypoint x="505" y="258" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="ParallelGateway_06rcg5a_di" bpmnElement="ParallelGateway_16h86fn">
        <omgdc:Bounds x="358" y="233" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_1w2llya_di" bpmnElement="SequenceFlow_1w2llya">
        <omgdi:waypoint x="383" y="283" />
        <omgdi:waypoint x="383" y="362" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="IntermediateCatchEvent_1h62sxa_di" bpmnElement="IntermediateCatchEvent_0q6ven5">
        <omgdc:Bounds x="365" y="362" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_09h2031_di" bpmnElement="SequenceFlow_09h2031">
        <omgdi:waypoint x="401" y="380" />
        <omgdi:waypoint x="505" y="380" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="ScriptTask_0iir1h0_di" bpmnElement="ScriptTask_0iir1h0">
        <omgdc:Bounds x="505" y="340" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_0p4haxv_di" bpmnElement="SequenceFlow_0p4haxv">
        <omgdi:waypoint x="605" y="380" />
        <omgdi:waypoint x="1090" y="380" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="EndEvent_0ezv08z_di" bpmnElement="EndEvent_0ezv08z">
        <omgdc:Bounds x="1090" y="362" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="EndEvent_0q5qgjl_di" bpmnElement="EndEvent_0g5eu8j">
        <omgdc:Bounds x="1108" y="232" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ScriptTask_0sq8f8r_di" bpmnElement="ScriptTask_0sq8f8r">
        <omgdc:Bounds x="910" y="263" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_073eyue_di" bpmnElement="SequenceFlow_073eyue">
        <omgdi:waypoint x="851" y="303" />
        <omgdi:waypoint x="910" y="303" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_07tn4l8_di" bpmnElement="SequenceFlow_07tn4l8">
        <omgdi:waypoint x="1010" y="303" />
        <omgdi:waypoint x="1050" y="303" />
        <omgdi:waypoint x="1050" y="250" />
        <omgdi:waypoint x="1108" y="250" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</definitions>

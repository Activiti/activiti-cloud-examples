version: '2'
services:
  # activiti-cloud-audit:
  #   image: activiti/activiti-cloud-audit:latest
  #   external_links:
  #     - activiti-cloud-sso-idm
  #     - activiti-cloud-registry
  #     - rabbitmq
  #   environment:
  #     - ACT_AUDIT_PORT=8181
  #     - JAVA_OPTS=-Xmx128m -Xms128m
  #     - ACT_CLOUD_CONFIG_SERVER_ENABLED=false
  activiti-cloud-audit:
      image: activiti/activiti-cloud-audit-mongodb:latest
      external_links:
        - activiti-cloud-sso-idm
        - rabbitmq
        - activiti-cloud-registry
      depends_on:
        - mongo
      environment:
        - ACT_AUDIT_PORT=8181
        - ACT_AUDIT_MONGO_HOST=mongo
        - ACT_AUDIT_MONGO_PORT=27017
        - ACT_AUDIT_MONGO_DB=activitidb
        - ACT_CLOUD_CONFIG_SERVER_ENABLED=false
  mongo:
      image: mongo
      ports:
       - "27017:27017"
  activiti-cloud-query:
    image: activiti/activiti-cloud-query:latest
    ports:
      - 8182:8182
    external_links:
      - activiti-cloud-sso-idm
      - activiti-cloud-registry
      - rabbitmq
    environment:
      - ACT_QUERY_PORT=8182
      - JAVA_OPTS=-Xmx128m -Xms128m
      - ACT_CLOUD_CONFIG_SERVER_ENABLED=false
  modeling-app:
    image: activiti/activiti-cloud-modeling-backend:latest
    external_links:
      - activiti-cloud-sso-idm
      - activiti-cloud-registry
      - rabbitmq
    environment:
      - ACT_MODELING_PORT=8088
      - ACT_MODELING_HOST=modeling-app
      - ACT_MODELING_APP_NAME=modeling-app
      - ACT_CLOUD_CONFIG_SERVER_ENABLED=false
  # We define the name and the base image of our Runtime Bundle
  rb-my-app:
      # Set image: to whichever you are using
      # This image was generated by the docker-runtime-bundle/Dockerfile
      image: activiti/example-runtime-bundle
      # This image was generated by the maven-runtime-bundle project
      #image: rb-my-maven-app
      external_links:
        - activiti-cloud-sso-idm
        - activiti-cloud-registry
        - rabbitmq
      depends_on:
        - rb-postgres
      # You can launch as many Runtime Bundles as you want by changing these Env variables
      environment:
        - ACT_RB_PORT=8081
        - ACT_RB_HOST=rb-my-app
        - ACT_RB_APP_NAME=rb-my-app
        - ACT_RB_DB_URI=jdbc:postgresql://rb-postgres:5432/activitidb
        - ACT_RB_DB_USER=postgres
        - ACT_RB_DB_PASS=password
        - ACT_RB_DB_PLATFORM=org.hibernate.dialect.PostgreSQLDialect
        - JAVA_OPTS=-Xmx256m -Xms256m
        - ACT_CLOUD_CONFIG_SERVER_ENABLED=false
      networks:
        - infrastructure
  # We decided to configure our runtime bundle against a PostgreSQL instance
  rb-postgres:
      image: postgres
      ports:
       - "5432:5432"
      environment:
        - POSTGRES_PASSWORD=password
        - POSTGRES_USER=postgres
        - POSTGRES_DB=activitidb
      networks:
        - infrastructure
# we will join the infrastructure network defined by the infrastructure docker compose.
networks:
  infrastructure:
    external:
      name: docker_default
